\section{Mechanical analysis}

\subsection{Inclination control}
In order to keep the inclination of the platform at a certain angle $\phi$ 
we must be able to compensate all the torque being applied to the platform.

\[\ddot{\phi}\cdot I_{platform} = \tau_{platform} \]

Assuming that the platform is well balanced (the center of masses is located
at the rotation axis) and neglecting the torque generated by the friction
with air, the sum of all the torques in the motor axis applied to the platform
is equal to the sum of the torque applied by the motors:

\[\tau_{platform} = \sum \tau_{motors}\]

The torque that the motors deliver to the wheels and to the flywheel create
a reaction in the platform in the opposite direction.

\[\tau_{platform} = -\tau_{motor-right-wheel} -\tau_{motor-left-wheel} -\tau_{motor-flywheel} \]

If we want keep the inclination $\phi$, we must be able to cancel $\tau_{platform}$.
Observe that the angular acceleration $\ddot{\phi}$ of the platform is linearly 
dependent with the torque it receives. 
\begin{equation} \label{eq:control equation}
\begin{split}
0 = -\tau_{motor-right-wheel} -\tau_{motor-left-wheel} -\tau_{motor-flywheel} \Rightarrow \\
\tau_{motor-right-wheel} +\tau_{motor-left-wheel} = -\tau_{motor-flywheel}
\end{split}
\end{equation}
In other words, we must compensate the torque of the wheels with the torque of the flywheel.

\subsection{Wheels torque}
The wheel torque we can induce is limited by the motor specifications. Note that the maximum torque of the motor is a function of velocity and in particular at max speed the torque is zero.

\[\tau_{motor-wheel} (\omega_{wheel}) \]

\begin{figure}
	\centering
    \begin{tikzpicture}
        %Axis
            \draw[->,thin] (center.center) -- (0,3.5) node[above] {$\tau_{motor}$};
            \draw[->,thin] (center.center) -- (3.5,0) node[right] {$\omega$};
        %Function
            \node (stall) at (0,3) [left]{stall torque};
            \node (maximum) at (3,0) [below]{maximum speed};
            \draw[-] (0,3) -- (3,0);
        \end{tikzpicture}
    \caption{Motor torque}
	\label{fig: Motor torque}
\end{figure}

We assume that the wheels just roll and do no slip.
The robot is pushed by the wheels that make a force $F_{friction}$ against the ground in the contact point. See figure \ref{fig:Wheel force diagram}.

We can express the torque at the center of the of the wheel as:
\[\tau_{motor-wheel} + F_{friction} \cdot r_{wheel} = I_{wheel} \cdot \dot{w}_{wheel} \]

\begin{equation} \label{wheel torque equation}
\tau_{motor-wheel} = I_{wheel} \cdot \dot{w}_{wheel} - F_{friction} \cdot r_{wheel}
\end{equation}
\begin{figure}[ht]
	\centering
	\begin{tikzpicture}
        \path[rotate=30] node (center) at (2,2) {};
        \draw (center) circle (2);
        \draw[rotate=30] (0,0) -- (4,0);
        \draw[dashed] (0,0) -- (4,0);
        \path node[above] (right) at ([shift=({2,0})]center) {};
        \draw[<->] (center.center) -- (right.center)  node[below, midway] {$r_{wheel}$};;
    %Arcs
        \draw[rotate=30, ->] (4.5,2) arc (0:30:2.5) node[above]{$\omega_{wheel}$};
        \draw[rotate=30, ->, thick] (2.5,2) arc (0:60:.5) node[above]{$\tau_{motor-wheel}$};

        \draw[->] (1,0) arc (0:30:1) node[right]{$\alpha$};
    %Forces
        \draw[rotate=30,->,thick] (2,0) -- (3.5,0) node[above]{$F_{friction}$};
        \draw[rotate=30,->,thick] (2,0) -- (2,1) node[above]{$N$};
        \path node[above] (below) at ([shift=({0,-1})]center) {};
    
        \draw[->,thick] (center.center) -- (below.center) node[below]{$m\cdot g$};
        \draw[rotate=30,->,thick] (center.center) -- (1,2) node[below]{$F_{platform}$};
    \end{tikzpicture}
	\caption{Wheel force diagram}
	\label{fig:Wheel force diagram}
\end{figure}


\subsection{Flywheel torque}
\begin{figure}
	\centering
    \begin{tikzpicture}
        %Circle
            \path node (center) at (0,0) {};
            \draw (center) circle (3);
        %Arcs
            \draw[->] (0,3.5) arc (90:120:3.5) node[above, midway]{$\theta$};
        %Movable mass
            \draw[rotate=120,fill=gray] (1.5,0) circle (.9) node (moving) [draw,circle]{};
        %Guide
            \draw[dashed,rotate=120] (.9,0) -- (2.1,0);
        %Other masses
            \foreach \i in {2}
            {
                \draw[rotate=60-60* \i,fill=gray] (3-.9,0) circle (.9) node[draw,circle]{};
            }
        %Radius
            \draw[<->] (0,0) -- (moving.center) node[near end, below] {$r$};
            \draw[rotate=-60,<->] (0,0) -- (2.1,0) node[midway, above] {$r_{max}$};
        %Axis
            \draw[->,thin] (center.center) -- (0,3.5) node[above] {$z$};
            \draw[->,thin] (center.center) -- (3.5,0) node[right] {$y$};
        %Motor torque
        \draw[->, thick] (0.5,0) arc (0:60:.5) node[right]{$\tau_{motor-flywheel}$};    
    \end{tikzpicture}
            \caption{Flywheel diagram for $N$ = 2}
	\label{fig:Flywheel force diagram}
\end{figure}

The flywheel torque we can induce is also limited by the motor specifications. 

Assuming a general configuration of the flywheel where the moving mass is at distance $r$ and angle $\theta$, see figure \ref{fig:Flywheel force diagram}. we formulate its torque the following way:
\[
    \tau_{motor-flywheel} + m_{cylinder} \cdot g \cdot (r - r_{max}) \cdot \sin{\theta} = \ddot{\theta}\cdot I_{flywheel}(r)  
\]
\begin{equation}\label{flywheel equation}    
    \tau_{motor-flywheel} = \ddot{\theta}\cdot I_{flywheel}(r) + m_{cylinder} \cdot g \cdot (r_{max} - r) \cdot \sin{\theta}  
\end{equation}

\subsection{Maximum speed, acceleration and inclination}
In this subsection we would like to study the maximum speed, acceleration and inclination the robot may surpass.

We will assume both wheels turn at the same speed, have the same $F_{friction}$ and the same $\tau_{wheel}$:
\[ \omega_{wheel-left} = \omega_{wheel-right} = \omega_{wheel} \]

\begin{figure}
	\centering
	\begin{tikzpicture}
        \path[rotate=30] node (center) at (2,2) {};
        \draw (center) circle (2);
        \draw[rotate=30] (0,0) -- (4,0);
        \draw[dashed] (0,0) -- (4,0);
        \path node[above] (right) at ([shift=({2,0})]center) {};
        \draw[<->] (center.center) -- (right.center)  node[below, midway] {$r_{wheel}$};;
    %Arcs
        \draw[rotate=30, ->] (4.5,2) arc (0:30:2.5) node[above]{$\omega_{wheel}$};
        \draw[rotate=30, ->, thick] (2.5,2) arc (0:60:.5) node[above]{$\tau_{motor-wheel}$};

        \draw[->] (1,0) arc (0:30:1) node[right]{$\alpha$};
        \draw[rotate=30,<-] (2,.5) arc (270:240:1.5) node[below, midway]{$\alpha$};
    %Forces
        \draw[rotate=30,->,thick] (2,0) -- (3.5,0) node[above]{$F_{friction}$};
        \draw[rotate=30,->,thick] (2,0) -- (2,1) node[above]{$N$};
        \path node[above] (below) at ([shift=({0,-1})]center) {};
    
        \draw[->,thick] (center.center) -- (below.center) node[below]{$m\cdot g$};
        \draw[rotate=30,->,thick] (center.center) -- (1,2) node[below]{$F_{platform}$};
    %Axis
        \draw[->,thin][rotate=30] (center.center) -- (2,5) node[above] {$z$};
        \draw[->,thin][rotate=30] (center.center) -- (5,2) node[right] {$y$};
        \draw[dashed][rotate=30] (center.center) -- (2,1);

    \end{tikzpicture}
    \caption{Wheel forward force diagram}
    \label{fig:Wheel forward force diagram}
\end{figure}

Applying Newton's first law in the y axis of figure \ref{fig:Wheel forward force diagram}:
\[\ddot{y}\cdot m_{total} = 2 \cdot F_{friction} - m_{total} \cdot g \cdot sin(\alpha)\]

Substituting $F_{friction}$ taking in to account equation \ref{wheel torque equation}:
\[\ddot{y}\cdot m_{total} = 2 \cdot \frac{I_{wheel} \cdot \dot{w}_{wheel}-\tau_{motor-wheel}}{r_{wheel}} - m_{total} \cdot g \cdot sin(\alpha)\]

Using equation \ref{eq:control equation}:
\begin{equation}\label{eq of acceleration}
    \Rightarrow  \ddot{y}\cdot m_{total} = \frac{2\cdot I_{wheel} \cdot \dot{w}_{wheel}}{r_{wheel}} + \frac{\tau_{motor-flywheel}}{r_{wheel}} - m_{total} \cdot g \cdot sin(\alpha)
\end{equation}


We will now study different cases to better understand this equation.
\subsubsection{No terrain inclination ($\alpha = 0$)}
The objective here is to obtain the maximum speed and acceleration we can get starting from rest in a plain surface.

The equation we get by substituting $\alpha = 0$ in equation \ref{eq of acceleration}:
\[\ddot{y}\cdot m_{total} = \frac{\tau_{motor-flywheel}}{r_{wheel}} +\frac{2\cdot I_{wheel} \cdot  \dot{w}_{wheel}}{r_{wheel}}\]

Substituting equation \ref{flywheel equation}
\begin{equation}\label{no inclintation eq}
    \ddot{y}\cdot m_{total} = \frac{\ddot{\theta}\cdot I_{flywheel}(r) + m_{cylinder} \cdot  g \cdot  (r_{max} - r) \cdot  \sin{\theta}}{r_{wheel}} +\frac{2\cdot I_{wheel} \cdot  \dot{w}_{wheel}}{r_{wheel}}
\end{equation}


We will now split the study in two cases:
\begin{enumerate}
    \item Flywheel case: $r$ is fixed to $r = r_{max}$ 
    
    Then:  
    \[\ddot{y}\cdot m_{total} = - \frac{\ddot{\theta}\cdot I_{flywheel}(r_{max})}
    {r_{wheel}} + \frac{2\cdot I_{wheel} \cdot  \dot{w}_{wheel}}{r_{wheel}}\]

    Taking in two account the following relation:
    \[-\omega_{wheel} \cdot  r_{wheel} = \dot{y} \Rightarrow  -\dot{w}_{wheel} \cdot  r_{wheel} = \ddot{y} \]

    The moments of inertia are:
    \[I_{wheel} \approx \frac{1}{2} \cdot m_{wheel} \cdot  r_{wheel}^2\]
    \[I_{flywheel} \approx N \cdot  m_{cylinder} \cdot  r_{max}^2\]

    Let's go for it:
    \[-\dot{w}_{wheel} \cdot  r_{wheel}\cdot m_{total} = \frac{\ddot{\theta}\cdot I_{flywheel}}
    {r_{wheel}} + \frac{2\cdot I_{wheel} \cdot  \dot{w}_{wheel}}{r_{wheel}} \]

    \[-\dot{w}_{wheel} \cdot (r_{wheel}\cdot m_{total} +  \frac{2\cdot I_{wheel} }{r_{wheel}}) = 
    \frac{\ddot{\theta}\cdot I_{flywheel}}{r_{wheel}}\]


    We define R as the quotient between $\dot{w}_{wheel}$ and $-\ddot{\theta}$

    \[R = \frac{\dot{w}_{wheel}}{-\ddot{\theta}} = 
    \frac{I_{flywheel}}
    {r_{wheel}^2\cdot m_{total} +  2\cdot I_{wheel}} \approx
    \frac{ N \cdot  m_{cylinder} \cdot  r_{max}^2}
    {r_{wheel}^2\cdot m_{total} +  2\cdot I_{wheel}} \] 

    We can see that R will always be smaller than 1 because $N \cdot  m_{cylinder} < m_{total} $ and $r_{max} < r_{wheel}$. This means that we will be limited by the acceleration of the flywheel.

    The forward acceleration is:
    \[\ddot{y} = -\dot{w}_{wheel} \cdot  r_{wheel} = R \cdot  \ddot{\theta} \cdot  r_{wheel}\]

    And using equation \ref{flywheel equation} we get that the maximum is:

    \[\tau_{motor} (w) = \ddot{\theta}\cdot I_{flywheel}(r) \Rightarrow \ddot{\theta} = \frac{\tau_{motor} (\dot{\theta})}{I_{flywheel}(r)} \]

    \[\ddot{y}_{max} = R \cdot  \frac{\tau_{motor} (\dot{\theta})}{I_{flywheel}(r)} \cdot  r_{wheel}\]

    \[\Rightarrow \ddot{y}_{max} =     \frac{I_{flywheel}}
    {r_{wheel}^2\cdot m_{total} +  2\cdot I_{wheel}}  \cdot  \frac{\tau_{motor} (\dot{\theta})}{I_{flywheel}(r)} \cdot  r_{wheel}\]
    \begin{equation}        
        \boxed{\ddot{y}_{max} = \frac{\tau_{motor}(\dot{\theta})\cdot r_{wheel} }
        {r_{wheel}^2\cdot m_{total} +  2\cdot I_{wheel}}}
        \label{maximum acceleration flywheel}
    \end{equation}
    In order to compute the maximum speed we will assume that the initial conditions are $\dot{\theta} = 0$ and 
    $\omega_{wheel}=0$

    \[\omega_{wheel-max} = \int_{t=0}^{t=t_{max}} \dot{w}_{wheel} \cdot  dt\]

    Now we will proceed to do a change of variables in the integral.

    \[
    \frac{\partial \dot{\theta}}{\partial t} = \ddot{\theta} \Rightarrow dt = \frac{d\dot{\theta}}{\ddot{\theta}}
    \]
    
    \[\omega_{wheel-max} = \int_{\dot{\theta}=0}^{\dot{\theta}=\dot{\theta}_{max}} \frac{\dot{w}_{wheel}}{\ddot{\theta}} \cdot  d\dot{\theta} = 
    \int_{\dot{\theta}=0}^{\dot{\theta}=\dot{\theta}_{max}} -R \cdot  d\dot{\theta} = - R \cdot  \dot{\theta}_{max}
    \]
    \begin{equation}
        \boxed{\dot{y}_{max} = r_{wheel} \cdot  R \cdot  \dot{\theta}_{max}}
        \label{Maximum speed flywheel}
    \end{equation}
    And $\dot{\theta}_{max}$ is a limitation imposed by the motor specifications. Note that this is the maximum speed
    we can get using the flywheel system starting from rest.


    \item Pendulum: $\dot{\theta} = 0$, and $r$ is fixed to $r = r_{min}$
    
    Using equation \ref{no inclintation eq} and $\ddot{\theta} = 0$
    \[\ddot{y}\cdot m_{total} = \frac{m_{cylinder} \cdot  g \cdot  (r_{max} - r_{min}) \cdot  \sin{\theta}}{r_{wheel}} +\frac{2\cdot I_{wheel} \cdot  \dot{w}_{wheel}}{r_{wheel}}\]
    Multiplying by $r_{wheel}$ both sides of the equation we get:
    \[\ddot{y}\cdot m_{total} \cdot  r_{wheel} = m_{cylinder} \cdot  g \cdot  (r_{max}-r_{min}) \cdot  \sin{\theta} + 2\cdot I_{wheel} \cdot  \dot{w}_{wheel}\]
    And using $\dot{w}_{wheel} = -\frac{\ddot{y}}{r_{wheel}}$
    \[\ddot{y}\cdot m_{total} \cdot  r_{wheel} + 2\cdot  I_{wheel} \cdot  \frac{\ddot{y}}{r_{wheel}} = m_{cylinder} \cdot  g \cdot  (r_{max}-r) \cdot  \sin{\theta} \]

    \[\ddot{y}  = \frac{m_{cylinder} \cdot  g \cdot  (r_{max}-r_{min}) \cdot  \sin{\theta}}{m_{total} \cdot  r_{wheel} + \frac{2\cdot I_{wheel}}{r_{wheel}} }  \]
    Which is maximum when $\sin{\theta}=1$
    \begin{equation}
        \boxed{ \ddot{y}_{max}  = \frac{m_{cylinder} \cdot  g \cdot  (r_{max}-r_{min}) \cdot}{m_{total} \cdot  r_{wheel} + \frac{2\cdot I_{wheel}}{r_{wheel}} } }
        \label{maximum acceleration pendulum}
    \end{equation}
    We need to take into consideration air friction to see the speed limitation in the pendulum case.
    \[F_{drag} = \frac{1}{2}\cdot \rho\cdot C_D \cdot  A \cdot  \dot{y}^2 \]

    Adding this term to equation \ref{eq of acceleration} we get:
    \[  \ddot{y}\cdot m_{total} = \frac{2\cdot I_{wheel} \cdot  \dot{w}_{wheel}}{r_{wheel}} + \frac{\tau_{motor-flywheel}}{r_{wheel}} - m_{total} \cdot  g \cdot  sin(\alpha) - F_{drag} \]
    And making $\ddot{y} = 0$ and $\alpha = 0$.
    \[  F_{drag} = \frac{\tau_{motor-flywheel}}{r_{wheel}}\]

    \[\frac{1}{2}\cdot \rho\cdot C_D \cdot  A \cdot  \dot{y}^2 = m_{cylinder} \cdot  g \cdot  (r_{max} - r_{min})\cdot sin(\theta) / r_{wheel} \]
    The maximum $\dot{y}$ is then obtained when $\theta=\frac{\pi}{2}$:
    \begin{equation*}
        \dot{y}_{max} = \sqrt{\frac{2\cdot m_{cylinder} \cdot  g \cdot  (r_{max} - r_{min})}{\rho\cdot C_D \cdot  A \cdot  r_{wheel}} }
    \end{equation*}

    We will pick $C_D=1$, $\rho=1.2 kg/m^3$ and $A=0.01 m^2$ for our computations.

    Also note that the speed is also limited by maximum speed a motor can get
    $\dot{\theta}_{max}$.
    \begin{equation}
        \boxed{\dot{y}_{max} = min(\dot{\theta}_{max}\cdot r_{wheel}, \sqrt{\frac{2\cdot m_{cylinder} \cdot  g \cdot  (r_{max} - r_{min})}{\rho\cdot C_D \cdot  A \cdot  r_{wheel}} })}
        \label{maximum speed pendulum}
    \end{equation}


\end{enumerate}
\subsubsection{No acceleration, just inclination ($\alpha > 0$)}
The goal of this subsubsection is to study which is the maximum inclination the robot can overpass.

Substituting $\ddot{y}=0$ and $\dot{\omega}_{wheel} = 0$ in equation \ref{eq of acceleration}
\[0 = \frac{\tau_{motor-flywheel}}{r_{wheel}} - m_{total} \cdot  g \cdot  sin(\alpha)\]
\[m_{total} \cdot  g \cdot  sin(\alpha) = \frac{\tau_{motor-flywheel}}{r_{wheel}} \]
\[sin(\alpha) = min(1,\frac{\tau_{motor-flywheel}}{m_{total} \cdot  g \cdot  r_{wheel}}) \]

Substituting equation \ref{flywheel equation}
\[sin(\alpha) = min(1,\frac{\ddot{\theta}\cdot I_{flywheel}(r) + m_{cylinder} \cdot  g \cdot  (r_{max} - r) \cdot  \sin{\theta}}{m_{total} \cdot  g \cdot  r_{wheel}}) \]


We are going to distinguish the same two cases as in the previous section:
\begin{enumerate}
    \item Flywheel case: $r$ is fixed to $r = r_{max}$
    The maximum inclination at a certain moment:
    \begin{equation}\label{Maximum angle using flywheel system}
        \boxed{sin(\alpha_{max}) = min(1,\frac{\ddot{\theta}\cdot I_{flywheel}}{m_{total} \cdot  g \cdot  r_{wheel}}) = min(1,\frac{\tau_{motor-flywheel}(\dot{\theta})}{m_{total} \cdot  g \cdot  r_{wheel}})}
    \end{equation}


    This angle doesn't give us a lot of information because it may not be fulfilled in a 
    permanent state. That's why in addition we would like to compute the maximum height
    our robot can achieve start from rest position.

    \[h=\int_{t=0}^{t=t_f} \dot{y}\cdot sin(\alpha) dt =\int_{t=0}^{t=t_f} sin(\alpha) (\int_{t=0}^{t=t} \ddot{y} dt)dt \]

    \[\ddot{y}(\frac{2\cdot I_{wheel}+ m_{total} \cdot r^2_{wheel} }{r^2_{wheel}}) =  \frac{\tau_{motor-flywheel}}{r_{wheel}} - m_{total} \cdot g \cdot sin(\alpha)\]

    \[\ddot{y}=
    \frac{r_{wheel}\cdot\tau_{motor-flywheel}}{2\cdot I_{wheel}+ m_{total} \cdot r^2_{wheel}}
    - \frac{m_{total} \cdot g \cdot sin(\alpha)\cdot r^2_{wheel}}{2\cdot I_{wheel}+ m_{total} \cdot r^2_{wheel}}\]

    \[\ddot{y}=A\cdot \tau_{motor-flywheel} + B\]

    \[\int_{t=0}^{t=t} \ddot{y} dt = \int_{t=0}^{t=t} (A\cdot \tau_{motor-flywheel} + B) dt\]


    \[=A\int_{t=0}^{t=t} \tau_{motor-flywheel} dt + B t \]

    From now on we will assume that we deliver the maximum torque to the flywheel.


    \[\tau_{motor}(\dot{\theta}) \approx \tau_{max}- \dot{\theta}\cdot\frac{\tau_{max}}{\dot{\theta}_{max}}\]
    \[\dot{\theta}(t)=\int \ddot{\theta}(t) dt
    = \frac{1}{I_f} \int \tau_{max}- \dot{\theta}(t)\cdot\frac{\tau_{max}}{\dot{\theta}_{max}} dt \]

    \[\dot{\theta}(t) = \frac{\tau_{max}\cdot t}{I_f} - \frac{\tau_{max}}{I_f \cdot \dot{\theta}_{max}}\int \dot{\theta}(t) dt \]
    \[\dot{\theta}(t) + \frac{\tau_{max}}{I_f \cdot \dot{\theta}_{max}}\cdot \theta(t) = \frac{\tau_{max}\cdot t}{I_f} \]
    Which is a non-homogeneous first order differential equation with solution:
    \begin{equation*}
        \mu(t) = e^{\int \frac{\tau_{max}}{I_f \cdot \dot{\theta}_{max}} dt} = e^{t\cdot \frac{\tau_{max}}{I_f \cdot \dot{\theta}_{max}}+C_1}
    \end{equation*}

    \begin{equation*}
        \theta(t) = \frac{\int(\mu(t) \cdot \frac{\tau_{max}\cdot t}{I_f})dt}{\mu(t)}
    \end{equation*}

    Integrating by parts
    \begin{equation*}
        \int(\mu(t) \cdot \frac{\tau_{max}\cdot t}{I_f})dt = \frac{\tau_{max}\cdot t}{I_f}\cdot\int\mu(t) - \int (\int \mu(t) dt) \cdot \frac{\tau_{max}}{I_f}dt
    \end{equation*}

    \begin{equation*}
        \int \mu(t) dt = \frac{I_f \cdot \dot{\theta}_{max}}{\tau_{max}} \cdot (e^{t\cdot \frac{\tau_{max}}{I_f \cdot \dot{\theta}_{max}}+C_1}+C_2)
    \end{equation*}

    \begin{equation*}
        \dot{\theta}_{max} \cdot t\cdot (e^{t\cdot \frac{\tau_{max}}{I_f \cdot \dot{\theta}_{max}}+C_1}+C_2) - \frac{I_f \cdot \dot{\theta}_{max}^2}{\tau_{max}} \cdot (e^{t\cdot \frac{\tau_{max}}{I_f \cdot \dot{\theta}_{max}}+C_1}+C_2) +C_3
    \end{equation*}


    \begin{equation*}
        (\dot{\theta}_{max} \cdot t- \frac{I_f \cdot \dot{\theta}_{max}^2}{\tau_{max}})\cdot (e^{t\cdot \frac{\tau_{max}}{I_f \cdot \dot{\theta}_{max}}+C_1}+C_2)+C_3 
    \end{equation*}

    \begin{equation*}
        \theta(t) = \frac{(\dot{\theta}_{max} \cdot t- \frac{I_f \cdot \dot{\theta}_{max}^2}{\tau_{max}})\cdot (e^{t\cdot \frac{\tau_{max}}{I_f \cdot \dot{\theta}_{max}}+C_1}+C_2)+C_3 }
        {e^{t\cdot \frac{\tau_{max}}{I_f \cdot \dot{\theta}_{max}}+C_1}}
    \end{equation*}


    \begin{equation*}
        \theta(t) = \frac{(\dot{\theta}_{max} \cdot t- \frac{I_f \cdot \dot{\theta}_{max}^2}{\tau_{max}})\cdot C_2 }
        {e^{t\cdot \frac{\tau_{max}}{I_f \cdot \dot{\theta}_{max}}+C_1}} 
        + (\dot{\theta}_{max} \cdot t- \frac{I_f \cdot \dot{\theta}_{max}^2}{\tau_{max}})
        + \frac{C_3 }
        {e^{t\cdot \frac{\tau_{max}}{I_f \cdot \dot{\theta}_{max}}+C_1}}
    \end{equation*}
Renaming the constants we get:
    \begin{equation*}
        \theta(t) = \frac{(\dot{\theta}_{max} \cdot t- \frac{I_f \cdot \dot{\theta}_{max}^2}{\tau_{max}})\cdot C_1 }
        {e^{t\cdot \frac{\tau_{max}}{I_f \cdot \dot{\theta}_{max}}}} 
        + (\dot{\theta}_{max} \cdot t- \frac{I_f \cdot \dot{\theta}_{max}^2}{\tau_{max}})
        + \frac{C_2 }
        {e^{t\cdot \frac{\tau_{max}}{I_f \cdot \dot{\theta}_{max}}}}
    \end{equation*}
    \begin{equation*}
        \theta(0) = -\frac{I_f \cdot \dot{\theta}_{max}^2}{\tau_{max}}\cdot C_1 
        - \frac{I_f \cdot \dot{\theta}_{max}^2}{\tau_{max}}
        + C_2 = 0
    \end{equation*}

    \begin{equation*}
        \dot{\theta(t)} = \frac{\dot{\theta}_{max}\cdot C_1 }
        {e^{t\cdot \frac{\tau_{max}}{I_f \cdot \dot{\theta}_{max}}}} 
        -\frac{(\dot{\theta}_{max} \cdot t- \frac{I_f \cdot \dot{\theta}_{max}^2}{\tau_{max}})\cdot C_1 \cdot \frac{\tau_{max}}{I_f \cdot \dot{\theta}_{max}} }
        {e^{t\cdot \frac{\tau_{max}}{I_f \cdot \dot{\theta}_{max}}}} 
        + \dot{\theta}_{max}
        - \frac{C_2\cdot \frac{\tau_{max}}{I_f \cdot \dot{\theta}_{max}} }
        {e^{t\cdot \frac{\tau_{max}}{I_f \cdot \dot{\theta}_{max}}}}
    \end{equation*}

    
    \begin{equation*}
        \dot{\theta(0)} = \dot{\theta}_{max}\cdot C_1
        +\frac{I_f \cdot \dot{\theta}_{max}^2}{\tau_{max}}\cdot C_1 \cdot \frac{\tau_{max}}{I_f \cdot \dot{\theta}_{max}}
        + \dot{\theta}_{max}
        - C_2\cdot \frac{\tau_{max}}{I_f \cdot \dot{\theta}_{max}}
    \end{equation*}
    
    
    \[\int_{t=0}^{t=t} \tau_{motor-flywheel} dt = 
    \int_{\dot{\theta}=0}^{\dot{\theta}=\dot{\theta}_{max}} \tau_{motor-flywheel}(\dot{\theta}) \frac{d\dot{\theta}}{\ddot{\theta}} \]

    \[\int_{\dot{\theta}=0}^{\dot{\theta}=t\cdot\ddot{\theta}} (\tau_{max}- \dot{\theta}\cdot\frac{\tau_{max}}{\dot{\theta}_{max}}) \frac{d\dot{\theta}}{\ddot{\theta}} =
    \frac{\tau_{max} \cdot t}{\ddot{\theta}} - \frac{1}{2}\cdot(t\cdot\ddot{\theta})^2 \frac{\tau_{max}}{\dot{\theta}_{max}\ddot{\theta}} 
    \]

    \[ \frac{\tau_{max} \cdot t}{\ddot{\theta}} - \frac{1}{2}\cdot t^2\cdot \frac{\ddot{\theta} \cdot \tau_{max}}{\dot{\theta}_{max}}\]

    \[t_f = \frac{\dot{\theta}_{max}}{\ddot{\theta}}\]

    \[h=sin(\alpha)\int_{t=0}^{t=t_f} (A \cdot(\frac{\tau_{max} \cdot t}{\ddot{\theta}} - \frac{1}{2}\cdot t^2\cdot \frac{\ddot{\theta} \cdot \tau_{max}}{\dot{\theta}_{max}} ) +B t)dt \]

    \[h=sin(\alpha)(\frac{1}{2}\frac{A\cdot\tau_{max}\dot{\theta}^2_{max}}{\ddot{\theta}^3} - \frac{1}{6}\frac{A\tau_{max} \dot{\theta}^2_{max}}{\ddot{\theta}^2} + \frac{1}{2}\frac{B \dot{\theta}^2_{max}}{\ddot{\theta}^2})\]

    2n way

    \begin{equation*}
        W=\int_{t_1}^{t_2}2\tau_{motor-wheel}(t)\cdot \omega(t) \cdot dt       
    \end{equation*}
    Using equation \ref{eq:control equation}:
    \begin{equation*}
        W=\int_{t_1}^{t_2}-\tau_{flywheel-wheel}(t)\cdot \omega(t) \cdot dt       
    \end{equation*}

    From equation \ref{eq of acceleration} we get:
    \begin{equation*}
        \tau_{motor-flywheel} =
        \dot{\omega}_{wheel} \cdot (-r_w^2\cdot m_{total}
        -2\cdot I_{wheel})
        + m_{total} \cdot g \cdot sin(\alpha) \cdot r_w
    \end{equation*}

    So there is a linear relation between $\tau_{flywheel-motor}$ and 
    $\dot{\omega}_{wheel}$:
    \begin{equation}
        \tau_f=A\cdot \dot{w}+ B
        \label{eq: tau-domega linear dependency}
    \end{equation}
    \begin{equation*}
        \dot{w}=C \cdot \tau_f+ D
    \end{equation*}
    \begin{equation*}
        C = 1/A
    \end{equation*}
    \begin{equation*}
        D = -B/A
    \end{equation*}

    Substituting equation \ref{eq: tau-domega linear dependency}:
    \begin{equation*}
        W=\int_{t_1}^{t_2}-(A\cdot \dot{\omega}(t)+B)\cdot \omega(t) \cdot dt       
    \end{equation*}
    Which we can split into kinetic energy and potential energy.
    \begin{equation*}
        W=[\frac{-A}{2}\cdot \omega(t)^2)]_{t_1}^{t_2}-\int_{t_1}^{t_2} B\cdot \omega(t) \cdot dt       
    \end{equation*}

    
    \begin{equation*}
        \int_{t_1}^{t_2} \omega(t) \cdot dt  
        = \int_{t_1}^{t_2} \int_{t_1}^{t} \dot{\omega}(t) \cdot dt \cdot dt
        = \int_{t_1}^{t} C\cdot\tau_{flywheel-wheel}(t) + D\cdot dt    
    \end{equation*}
    Using equation \ref{flywheel equation}:
    \begin{equation*}
        \int_{t_1}^{t}\tau_{flywheel-wheel}(t) dt = 
        \int_{t_1}^{t}\ddot{\theta}(t)\cdot I_f dt = 
        I_f \cdot \int_{t_1}^{t}\ddot{\theta}(t) dt = 
    \end{equation*}
    \begin{equation*}
        \int_{t_1}^{t}\ddot{\theta}(t) dt = 
        [\dot{\theta}(t)]_{t_1}^{t} 
    \end{equation*}
    \begin{equation*}
        \int_{t_1}^{t_2} \omega(t) \cdot dt
        = \int_{t_1}^{t_2} [D]_{t_1}^{t} + C\cdot I_f \cdot[\dot{\theta}(t)]_{t_1}^t dt
        = \int_{t_1}^{t_2} D\cdot t - D \cdot t_1+ C\cdot I_f \cdot (\dot{\theta}(t)-\dot{\theta}(t_1)) dt     
    \end{equation*}

    \begin{equation*}
        \int_{t_1}^{t_2} \dot{\theta}(t) dt = [\theta(t)]_{t_1}^{t_2}
    \end{equation*}
    \begin{equation*}
        [\frac{D\cdot t^2}{2}]_{t_1}^{t_2} - [D \cdot t_1 \cdot t]_{t_1}^{t_2}+
        C\cdot I_f \cdot ([\theta(t)]_{t_1}^{t_2}-[\dot{\theta}(t_1)\cdot t]_{t_1}^{t_2})     
    \end{equation*}
    \begin{equation}
        \label{eq: Work equation}
        W=
        [\frac{-A}{2}\cdot \omega(t)^2)]_{t_1}^{t_2}-
        B \cdot (
        [\frac{D\cdot t^2}{2}]_{t_1}^{t_2} - [D \cdot t_1 \cdot t]_{t_1}^{t_2}+
        C\cdot I_f \cdot ([\theta(t)]_{t_1}^{t_2}-[\dot{\theta}(t_1)\cdot t]_{t_1}^{t_2}))     
    \end{equation}
    Replacing initial conditions:
    \begin{itemize}
        \item $\omega(t1)=0$
        \item $\dot{\theta}(t1)=0$
        \item $t1=0$
    \end{itemize}

    And forcing the final speed to be zero:
    \begin{itemize}
        \item $\omega(t2)=0$
        \item \begin{equation*}
            \int_{t1}^{t2} \dot{w} = 0
        \end{equation*}
    \end{itemize}
    \begin{equation*}
        \int_{t1}^{t2} \dot{w} = \int_{t1}^{t2} C\cdot I_f \cdot \ddot{\theta(t)} + D
    \end{equation*}
    \begin{equation*}
        W=
        -B \cdot (
        \frac{D\cdot t_2^2}{2}+
        C\cdot I_f \cdot [\theta(t)]_{t_1}^{t_2})     
    \end{equation*}

    
    \begin{equation*}
        W=        
        \frac{B^2\cdot t_2^2}{A \cdot 2}-
        \frac{B \cdot I_f \cdot [\theta(t)]_{t_1}^{t_2}}{A}     
    \end{equation*}
    \dots
    
    \begin{equation*}
        \frac{\partial W}{\partial t_2}=        
        \frac{B^2\cdot t_2}{A}-
        \frac{B \cdot I_f \cdot \dot{\theta}(t_2)}{A} = 0     
    \end{equation*}


    \begin{equation*}
        t_2 =
        \frac{I_f \cdot \dot{\theta}(t_2)}{B}     
    \end{equation*}

    \begin{equation*}
        \dot{\theta}(t_2)  =
        \frac{B \cdot t_2}{I_f}     
    \end{equation*}


    \begin{equation*}
        \dot{\theta}(t_2)  =
        \frac{B \cdot t_2}{I_f}     
    \end{equation*}


    \begin{equation*}
        W=        
        \frac{I_f^2\cdot \dot{\theta(t_2)}^2}{A \cdot 2}-
        \frac{B \cdot I_f \cdot [\theta(t)]_{t_1}^{t_2}}{A}     
    \end{equation*}


    \item Pendulum: $\dot{\theta} = 0$, and $r$ is fixed to $r = r_{min}$
    \[sin(\alpha) = \frac{min(\tau_{motor-flywheel},m_{cylinder} \cdot  g \cdot  (r_{max} - r_{min}) \cdot  \sin{\theta})}{m_{total} \cdot  g \cdot  r_{wheel}} \]
    \begin{equation}\label{Maximum angle using pendulum system}
        \boxed{sin(\alpha_{max}) = \frac{min(\tau_{motor-flywheel},m_{cylinder} \cdot  g \cdot  (r_{max} - r_{min}))}{m_{total} \cdot  g \cdot  r_{wheel}}}
    \end{equation}
    Note that the $sin(\alpha_{max})$ will not be more than 1.
\end{enumerate}
